-------------------YEARWISE------------------------------

1)TOTAL TICKET COUNT FOR CHILD ON PEAKDAYS
------------------------------------------
create or replace view v_tkt_cnt_peak_chd_yearly
AS
select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Child' "Category",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.day_cd=8 
          AND TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=2 AND s.catg_grp=c.catg_grp)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR >=20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD 
UNION
select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Child' "Category",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=2)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR < 20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD
order by 1,2;



2)TOTAL TICKET COUNT FOR ADULT ON PEAKDAYS
------------------------------------------

create or replace view v_tkt_cnt_peak_ADULT_yearly
AS
select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Adult' "Category",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.day_cd=8 
          AND TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=1 AND s.catg_grp=c.catg_grp)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR >=20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD 
UNION
select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Adult' "Category",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=1)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR < 20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD
order by 1,2;


2)TOTAL TICKET COUNT FOR CHILD AND ADULT ON PEAKDAYS
----------------------------------------------------

create or replace view v_tkt_cnt_peak_adult_chd_yearly
AS
(select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Adult' "Category",'Peakday' "Day",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.day_cd=8 
          AND TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=1 AND s.catg_grp=c.catg_grp)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR >=20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD 
UNION
select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Adult' "Category",'Peakday' "Day",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=1)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR < 20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD
)
UNION ALL
(
select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Child' "Category",'Peakday' "Day",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.day_cd=8 
          AND TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=2 AND s.catg_grp=c.catg_grp)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR >=20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD 
UNION
select C.BRANCH_DESC "BRANCH NAME",B.FIN_YEAR "FINANCIAL YEAR",'Child' "Category",'Peakday' "Day",NVL(a.TOTAL_TICKETS,0) "TOTAL TKTS"
FROM   (SELECT TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
        FROM TKT_DTL,TKT_HDR
        WHERE
          TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
          TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
          TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
          TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
          TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
          TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
          TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=2)
        group by TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD) 
        ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C
WHERE A.FIN_YEAR(+)=B.FIN_YEAR AND B.FIN_YEAR < 20162017 AND  A.BRANCH_NAME(+)=C.BRANCH_CD
)
order by 1,2,3;




-------------------------------------------MONTHWISE----------------------------------

1)TOTAL TICKET COUNT FOR CHILD ON PEAKDAYS
  ------------------------------------------
create or replace view v_tkt_cnt_peak_chd_monthly
AS
SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'Adult' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,
NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.day_cd in (8) AND 
        TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=2 AND s.catg_grp=c.catg_grp)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY'))
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+) AND D.FIN_YEAR >=20162017 
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
UNION ALL
SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'Adult' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=2)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) 
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+)  AND  D.FIN_YEAR< 20162017
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
  ORDER BY 1,2,3,4,5;   



2)TOTAL TICKET COUNT FOR ADULT ON PEAKDAYS
  ------------------------------------------
create or replace view v_tkt_cnt_peak_ADULT_monthly
AS
SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'Adult' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,
NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.day_cd in (8) AND 
        TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=1 AND s.catg_grp=c.catg_grp)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY'))
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+) AND D.FIN_YEAR >=20162017 
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
UNION ALL
SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'Adult' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=1)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) 
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+)  AND  D.FIN_YEAR< 20162017
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
  ORDER BY 1,2,3,4,5;   





3)TOTAL TICKET COUNT FOR CHILD AND ADULT ON PEAKDAYS
----------------------------------------------------
create or replace view v_tkt_cnt_peak_adult_chd_monthly
AS

(SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'child' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,
NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.day_cd in (8) AND 
        TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=2 AND s.catg_grp=c.catg_grp)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY'))
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+) AND D.FIN_YEAR >=20162017 
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
UNION ALL
SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'child' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=2)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) 
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+)  AND  D.FIN_YEAR< 20162017
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
     )
     
 UNION ALL
(
SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'Adult' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,
NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.day_cd in (8) AND 
        TKT_DTL.CATG IN (SELECT S.CATG FROM SUB_CATG_MAST S, CATG_GRP C
                               WHERE C.CATG_GRP=1 AND s.catg_grp=c.catg_grp)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY'))
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+) AND D.FIN_YEAR >=20162017 
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
UNION ALL
SELECT  C.BRANCH_DESC "BRANCH NAME",D.FIN_YEAR "FINANCIAL YEAR",D.MON1 "MONTH",'Weekdays' "Day",'Adult' "CategoryName",NVL(A.TOTAL_TICKETS,0) "TOTAL TKTS"
from   (select TKT_HDR.FIN_YEAR,(TKT_HDR.BRANCH_CD) BRANCH_NAME,(TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) YEAR1,NVL(SUM(TKT_DTL.NO_PERS),0) TOTAL_TICKETS 
      FROM TKT_DTL,TKT_HDR
      WHERE
        TKT_HDR.FIN_YEAR = TKT_DTL.FIN_YEAR AND
        TKT_DTL.POS_POINT_CD = TKT_HDR.POS_POINT_CD AND
        TKT_DTL.SUB_CD = TKT_HDR.SUB_CD AND
        TKT_DTL.REC_NO = TKT_HDR.REC_NO AND
        TKT_DTL.DAY_CD = TKT_HDR.DAY_CD AND 
        TKT_DTL.BRANCH_CD = TKT_HDR.BRANCH_CD  AND
        TKT_DTL.DAY_CD IN (5,6) AND TKT_DTL.CATG_CD IN (SELECT CATG_CD FROM CATEGORY 
                                                                                   WHERE CATG_GRP=1)
      GROUP BY TKT_HDR.FIN_YEAR, (TKT_HDR.BRANCH_CD), (TO_CHAR(TKT_HDR.TRANS_DT,'MON-YY')) 
      ORDER BY 1,2
      ) A , V_TKT_FYEAR B,BRANCH_MAST C,(SELECT DISTINCT FIN_YEAR,TO_CHAR(FIN_DATE,'MON-YY') YEAR2,TO_CHAR(FIN_DATE,'MON') MON1 FROM V_TKT_DATE) D
WHERE A.FIN_YEAR=B.FIN_YEAR(+)  AND  D.FIN_YEAR< 20162017
     AND   A.BRANCH_NAME(+)=C.BRANCH_CD
     AND   A.YEAR1(+)=D.YEAR2
)
order by 1,2,3,4,5;

